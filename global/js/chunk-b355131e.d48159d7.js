(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b355131e"],{"341b":function(t,e,s){},"3b38":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{height:"calc(100vh - 80px)"}},[s("div",{staticClass:"card card-body m-3 p-0 overflow-hidden",staticStyle:{height:"100%"}},[s("splitpanes",{staticClass:"default-theme file-manager"},[s("pane",{attrs:{"min-size":"20",size:"20"}},[s("div",{staticClass:"fm-header border-bottom d-flex"},[s("div",{staticClass:"flex-grow-1 pr-3"},[t._v("Папкалар")]),s("div",{staticClass:"d-flex",staticStyle:{"grid-gap":"10px"}},[s("div",{staticClass:"cursor-pointer",on:{click:function(e){return t.showCreateDirectoryModal()}}},[s("i",{staticClass:"mdi mdi-folder-plus"})]),s("div",{staticClass:"cursor-pointer",on:{click:function(e){return t.showCreateFileDialog()}}},[s("i",{staticClass:"mdi mdi-file-plus"})])])]),t.folders["/"]?s("folder-tree-item",{staticClass:"bg-white",attrs:{item:t.rootFolder}}):t._e()],1),s("pane",{staticStyle:{overflow:"scroll"},attrs:{"min-size":"50"}},[s("div",{staticClass:"fm-header border-bottom d-flex"},[s("div",{staticClass:"flex-grow-1 pr-3"},[t._v("Папкадаги файллар "+t._s(t.activeFolder))]),s("div",{staticClass:"d-flex",staticStyle:{"grid-gap":"20px"}},[s("div",{staticClass:"cursor-pointer",on:{click:function(e){return t.showCreateDirectoryModal(t.activeFolder)}}},[s("i",{staticClass:"mdi mdi-folder-plus"}),t._v(" Янги папка ")]),s("div",{staticClass:"cursor-pointer",on:{click:function(e){return t.showCreateFileDialog(t.activeFolder)}}},[s("i",{staticClass:"mdi mdi-file-plus"}),t._v(" Янги файл ")])])]),s("file-table",{staticClass:"bg-white",attrs:{items:t.activeFolderFiles}})],1)],1)],1)])},r=[],a=s("c973"),o=s.n(a),n=s("9def"),l=(s("c1ea"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("table",{staticClass:"table table-bordered"},[s("thead",[s("tr",[s("th",{class:{active:t.sortingDesc&&"name"==t.sortedBy},on:{click:function(e){return t.sortedByItem("name")}}},[s("div",{},[t._v(" Номи "),s("svg",{attrs:{width:"10px",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"}},[s("path",{attrs:{d:"M209.4 39.4C204.8 34.7 198.6 32 192 32s-12.8 2.7-17.4 7.4l-168 176c-9.2 9.6-8.8 24.8 .8 33.9s24.8 8.8 33.9-.8L168 115.9V456c0 13.3 10.7 24 24 24s24-10.7 24-24V115.9L342.6 248.6c9.2 9.6 24.3 9.9 33.9 .8s9.9-24.3 .8-33.9l-168-176z"}})])])]),s("th",{class:{active:t.sortingDesc&&"size"==t.sortedBy},on:{click:function(e){return t.sortedByItem("size")}}},[t._v(" Ўлчами "),s("svg",{attrs:{width:"10px",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"}},[s("path",{attrs:{d:"M209.4 39.4C204.8 34.7 198.6 32 192 32s-12.8 2.7-17.4 7.4l-168 176c-9.2 9.6-8.8 24.8 .8 33.9s24.8 8.8 33.9-.8L168 115.9V456c0 13.3 10.7 24 24 24s24-10.7 24-24V115.9L342.6 248.6c9.2 9.6 24.3 9.9 33.9 .8s9.9-24.3 .8-33.9l-168-176z"}})])]),s("th")])]),s("tbody",t._l(t.sortedItems,(function(e){return s("tr",[s("td",[t._v(t._s(e.name))]),s("td",[t._v(t._s(t._f("prettyBytes")(e.size)))]),s("td",[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip",value:"Юклаб олиш",expression:"'Юклаб олиш'"}],staticClass:"fa fa-download cursor-pointer mx-1",on:{click:function(s){return t.download(e)}}}),s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip",value:"Жойлашув манзилини кўчириб олиш",expression:"'Жойлашув манзилини кўчириб олиш'"}],staticClass:"fa fa-link cursor-pointer mx-1",on:{click:function(s){return t.copyLink(e)}}}),s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip",value:"Файлни ўчириш",expression:"'Файлни ўчириш'"}],staticClass:"fa fa-trash cursor-pointer mx-1",on:{click:function(s){return t.deleteFileDialog(e.path,e.name)}}})])])})),0)])])}),c=[],d=s("778c"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p-modal",{scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Файл юклаш")]},proxy:!0}])},[s("div",[t._v(t._s(this.parentFolder)+" да янги файл яратилади"),s("br"),t._v(t._s(t.$l("platon.select_file","Файлни танланг")))]),s("input",{ref:"file",attrs:{type:"file",multiple:""},on:{change:t.onFileSelected}}),t.existences?t._e():s("div",{staticClass:"mt-2"},[s("button",{staticClass:"btn btn-primary",attrs:{disabled:null==t.inputVal},on:{click:t.upload}},[t._v("Юклаш")])]),t.existences?s("div",{staticClass:"exists"},[s("h3",[t._v(t._s(t.existencesList.length)+"та файл саҳифада мавжуд:")]),s("ul",t._l(t.existencesList,(function(e){return s("li",{key:e},[t._v(t._s(e))])})),0),s("button",{staticClass:"btn btn-primary",on:{click:t.close}},[t._v("Тушунарли")])]):t._e()])},u=[],h={name:"FileUploadDialog",props:{parentFolder:{},createFile:{}},data(){return{inputVal:null,existences:!1,existencesList:[]}},methods:{onFileSelected(t){const e=t.target.files;this.existences=!1,this.inputVal=e},upload(){var t=this;return o()((function*(){const e=yield t.createFile(t.parentFolder,t.inputVal);0===e.length?t.$emit("close"):(t.existencesList=e,t.existences=!0)}))()},close(){this.$emit("close")}}},m=h,f=(s("f837"),s("2877")),v=Object(f["a"])(m,p,u,!1,null,"8d4c78be",null),g=v.exports,F=s("b441"),_={methods:{showCreateDirectoryModal(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";this.promptAction("Папка яратиш",e+" да янги папка яратилади<br>Папка номини киритинг",{confirmText:"Яратиш",rejectText:"Бекор қилиш"}).then(function(){var s=o()((function*(s){const i=yield t.createFolder(e,s);t._getFileManager().addFolder(e,i)}));return function(t){return s.apply(this,arguments)}}())},createFolder(t,e){var s=this;return o()((function*(){const i=e.replace(/\W+/g,"-"),r=("web/v1/store/directory"+t+"/"+i).replace(/\/\/+/g,"/"),a=yield s.$api.post(r,{},{baseURL:F["API_BASE_URL"]});return a.data}))()},_getFileManager(){return this.fm||this},showCreateFileDialog(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";this.$modal.show(g,{parentFolder:e,createFile:function(){var e=o()((function*(e,s){let i=t._getFileManager()._data.folders[e],r=i.map(t=>t["name"]);const a=[];for(let o of s)if(r.includes(o["name"]))a.push(o["name"]);else{const s=yield t.createFile(e,o);t._getFileManager().addFile(e,s)}return a}));return function(t,s){return e.apply(this,arguments)}}()},{width:"450px"})},createFile(t,e){var s=this;return o()((function*(){const i=new FormData;i.append("file",e,e.name);const r=yield s.$api.post("web/v1/store/upload"+t,i,{baseURL:F["API_BASE_URL"]});return r.data}))()},deleteFileDialog(t,e){var s=this;this.confirmAction(o()((function*(){yield s.deleteFile(Object(d["a"])(t,e)),s._getFileManager().removeFile(t,e)})),{text:e+" ни ўчиришни хоҳлайсизми ?"})},deleteFile(t){var e=this;return o()((function*(){const s=yield e.$api.delete("web/v1/store/info"+t,{baseURL:F["API_BASE_URL"]});return s.data}))()}}},b={name:"FileTable",mixins:[_],inject:["fm"],props:{items:{}},data(){return{sortedBy:"",sortingDesc:!1,rotateDesc:!1}},created(){this.setInitialSorts()},computed:{sortedItems(){return this.items.sort((t,e)=>{let s=t[this.sortedBy]>e[this.sortedBy];return this.sortingDesc?s?-1:1:s?1:-1})}},methods:{setInitialSorts(){const t=JSON.parse(localStorage.getItem("file_manager_sorts")||JSON.stringify({sortedBy:"name"}));this.sortedBy=t.sortedBy,this.sortingDesc=t.sortingDesc},download(t){window.open(this.getUrl(t),"_blank")},sortedByItem(t){this.sortedBy=t,this.sortingDesc=!this.sortingDesc,localStorage.setItem("file_manager_sorts",JSON.stringify({sortedBy:t,sortingDesc:this.sortingDesc}))},copyLink(t){navigator.clipboard.writeText(this.getUrl(t)),this.$platonApp.greenToast(this.$l("platon.toast_success_moved","Кўчирилди"))},getUrl(t){return Object(d["a"])(this.$const.API_BASE_URL,"web/v1/store/file",t.path,t.name)}}},y=b,w=Object(f["a"])(y,l,c,!1,null,null,null),C=w.exports,x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"px-2 cursor-pointer fm-tree-folder",class:{active:t.fm.isActiveFolder(t.path)},on:{click:function(e){return e.stopPropagation(),t.onFolderClick()}}},[t.isLoading?s("i",{staticClass:"mdi mdi-loading mdi-spin"}):s("i",{staticClass:"mdi",class:[t.isOpen?"mdi-folder-open":"mdi-folder"]}),t._v(" "+t._s(t.item.name)+" "),s("span",{staticClass:"actions"},[s("i",{staticClass:"mdi mdi-folder-plus",on:{click:function(e){return e.stopPropagation(),t.showCreateDirectoryModal(t.path)}}}),s("i",{staticClass:"mdi mdi-file-plus",on:{click:function(e){return e.stopPropagation(),t.showCreateFileDialog(t.path)}}}),s("i",{staticClass:"mdi mdi-trash-can",on:{click:function(e){return e.stopPropagation(),t.deleteFileDialog(t.item.path,t.item.name)}}})])]),t.fm.isOpen(t.path)?s("div",{staticClass:"ml-2"},t._l(t.children,(function(t){return s("folder-tree-item",{key:t.name,attrs:{item:t}})})),1):t._e()])},D=[],k={name:"FolderTreeItem",mixins:[_],props:{item:{required:!0,type:Object}},inject:["fm"],methods:{onFolderClick(){const t=this.path;this.fm.state[t].isLoaded?this.fm.isActiveFolder(t)&&this.fm.toggleFolder(t):this.fm.loadFolderData(t),this.fm.setActiveFolder(t)}},computed:{path(){return Object(d["a"])(this.item.path,this.item.name)},state(){return this.fm.state[this.path]},isLoading(){return this.state&&this.state.isLoading},isOpen(){return this.state&&this.state.isOpen},children(){return(this.fm.folders[this.path]||[]).filter(t=>"DIRECTORY"===t.type)}}},L=k,O=(s("6831"),Object(f["a"])(L,x,D,!1,null,null,null)),$=O.exports,B=s("5228"),S={name:"FileManager",components:{FolderTreeItem:$,FileTable:C,Splitpanes:n["b"],Pane:n["a"]},mixins:[_],beforeRouteEnter(t,e,s){const i=Object(B["d"])();i&&Array.isArray(i.permissions)&&i.permissions.includes("platon.admin")?s():s("/")},provide(){return{fm:this}},data(){return{folders:{},state:{},activeFolder:"/"}},created(){this.initFolder("/"),this.loadFolderData()},computed:{activeFolderFiles(){return(this.folders[this.activeFolder]||[]).filter(t=>"FILE"===t.type)},rootFolder(){return{name:"/",path:"",size:0,type:"DIRECTORY",children:this.folders["/"]}}},methods:{initFolder(t){this.state[t]||this.$set(this.state,t,{})},loadFolderData(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";return o()((function*(){t.$set(t.state[e],"isLoading",!0);const s=("/web/v1/store/list/"+e).replace(/\/\/+/g,"/");try{const i=yield t.$api.get(s,{baseURL:F["API_BASE_URL"]});t.$set(t.folders,e,i.data.data.results),t.$set(t.state[e],"isOpen",!0),t.$set(t.state[e],"isLoaded",!0),i.data.data.results.forEach(e=>{t.initFolder(Object(d["a"])(e.path,e.name))})}finally{t.$set(t.state[e],"isLoading",!1)}}))()},toggleFolder(t){this.$set(this.state[t],"isOpen",!this.state[t].isOpen)},isOpen(t){return!0===this.state[t].isOpen||void 0===this.state[t].isOpen},addFolder(t,e){const s=this.folders[t];s.push(e),this.$set(this.folders,t,s),this.initFolder(Object(d["a"])(e.path,e.name))},addFile(t,e){const s=this.folders[t];s.push(e),this.$set(this.folders,t,s)},removeFile(t,e){const s=this.folders[t];this.$set(this.folders,t,s.filter(t=>t.name!==e))},setActiveFolder(t){this.activeFolder=t},isActiveFolder(t){return this.activeFolder===t}}},A=S,I=(s("829e"),Object(f["a"])(A,i,r,!1,null,null,null));e["default"]=I.exports},"5a3a":function(t,e,s){},6831:function(t,e,s){"use strict";s("341b")},"7ef8":function(t,e,s){},"829e":function(t,e,s){"use strict";s("5a3a")},f837:function(t,e,s){"use strict";s("7ef8")}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-26e76bc0"],{"107a":function(t,e,a){(function(e,l){t.exports=l(a("ec45"))})(0,(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t}function a(t,e){return e={exports:{}},t(e,e.exports),e.exports}t=t&&t.hasOwnProperty("default")?t["default"]:t;var l=a((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var a={months:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],monthsShort:["янв.","февр.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],weekdays:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],weekdaysShort:["вс","пн","вт","ср","чт","пт","сб"],weekdaysMin:["вс","пн","вт","ср","чт","пт","сб"],firstDayOfWeek:1,firstWeekContainsDate:1},l=a;e["default"]=l,t.exports=e.default})),r=e(l),s={formatLocale:r,yearFormat:"YYYY",monthFormat:"MMM",monthBeforeYear:!0};return t.locale("ru",s),s}))},5351:function(t,e,a){"use strict";var l=a("1832");e["a"]={methods:{injectJsFromUrl(t,e){this.$http.get(t).then(t=>{e&&e(t.data)})},injectScopeJs(t,e,a){t&&Object(l["a"])(t,e,a)}}}},"9f7e":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.draw?a("div",[200===t.$chimera.loadTable.status?a("NotificationContainer",{attrs:{"event-name":t.notificationEvent}}):t._e(),200===t.$chimera.loadTable.status&&t.$chimera.loadTable.data.css?a("v-style",[t._v(" "+t._s(t.$chimera.loadTable.data.css)+" ")]):t._e(),a("div",{class:t.tableClasses},[a("TableFilterWrapper",{attrs:{"show-filters":t.showFilters,items:t.renderingFilters},scopedSlots:t._u([{key:"title",fn:function(){return[t.breadcrumbsEndpoint?a("table-breadcrumb",{attrs:{filters:t.activeFilters,endpoint:t.breadcrumbsEndpoint}}):t._e(),t.table&&t.showHeader?a("h5",{ref:"header",staticClass:"text-center mb-0 py-2 over-hover table-title"},[a("component-maker",{attrs:{content:"<span>"+t.table.header+"</span>",name:"table-title"}}),t.isAdmin&&t.isMyProject(t.table)?a("PlatonLink",{staticClass:"small over-target",attrs:{link:"/forms/tables/"+t.tableId+"?_target=modal"}},[a("i",{staticClass:"fa fa-cog"})]):t._e()],1):t._e()]},proxy:!0}],null,!1,1888456424),model:{value:t.filterData,callback:function(e){t.filterData=e},expression:"filterData"}},[a("b-skeleton-wrapper",{attrs:{loading:t.showTableSkeleton},scopedSlots:t._u([{key:"loading",fn:function(){return[t.showHeader?a("div",{staticClass:"d-flex justify-content-center"},[a("b-skeleton",{staticClass:"my-2 mb-4",attrs:{width:"70%",height:"35px"}})],1):t._e(),a("b-skeleton-table",{attrs:{rows:15,columns:6,"table-props":{bordered:!0,striped:!0}}})]},proxy:!0}],null,!1,3977687533)},[t.table?a("div",{ref:"container"},[t.columns.length>0&&200===t.$chimera.loadTable.status?a("PTable",{ref:"table",attrs:{columns:t.columns,"table-name":t.tableName,"left-fixed":t.$chimera.loadTable.data.leftFixed,"right-fixed":t.$chimera.loadTable.data.rightFixed,navigateByKeyboard:t.navigateByKeyboard,"extra-columns":t.extraColumns,groupBy:t.groupingBy,"split-rows-by":t.splitRowsBy,"max-height":t.maxHeight,"table-data":t.tableData,"columns-config":t.columnsConfig,level:t.tableLevel,"table-id":t.tableId}}):t._e(),t.paginationEnabled&&t.showPagination?a("div",{staticClass:"table-pagination pt-2"},[a("b-pagination",{ref:"pagination",staticClass:"mb-0",attrs:{"total-rows":t.data.total,"per-page":t.pageSize,limit:"7","last-number":"","first-number":""},scopedSlots:t._u([{key:"prev-text",fn:function(){return[a("i",{staticClass:"fa fa-chevron-left",staticStyle:{"font-size":"12px"}})]},proxy:!0},{key:"next-text",fn:function(){return[a("i",{staticClass:"fa fa-chevron-right",staticStyle:{"font-size":"12px"}})]},proxy:!0}],null,!1,2911177668),model:{value:t.currentPage,callback:function(e){t.currentPage=t._n(e)},expression:"currentPage"}}),a("p",{staticClass:"table-pagination-text",domProps:{innerHTML:t._s(t.$l("platon.paginationInfo","Умумий <span>%total</span> тa ёзувларнинг <span>%from</span> дан <span>%to</span> гачаси кўрсатилмоқда").replace("%total",t.paginationStats.total).replace("%from",t.paginationStats.from).replace("%to",t.paginationStats.to))}})],1):t._e()],1):t._e(),t.$chimera.loadTable.status>=400?a("ChimeraErrorsView",{staticStyle:{height:"400px"},attrs:{endpoint:t.$chimera.loadTable,icon:"fa fa-table","access-denied-text":t.$l("platon.table_has_no_access","Бу жадвални кўришга рухсат берилмаган"),"not-found-text":t.$l("platon.table_not_found","Жадвал топилмади")}}):t._e()],1)],1)],1),t.controlButtons&&t.table&&t.isAdmin&&t.isMyProject(t.table)?a("TableControls",{staticClass:"py-2 control-buttons",attrs:{table:t.table}}):t._e()],1):t._e()},r=[],s=a("9523"),i=a.n(s),n=a("448a"),o=a.n(n),c=a("c973"),u=a.n(c),d=a("7f3d"),p=a("abc1"),h=a("72f9"),m=a("98b2"),b=a("5351"),f=a("6c9a"),y=a("c1df"),g=a.n(y),_=a("b441");function v(t){if(t&&t.filters&&Array.isArray(t.filters))for(let e of t.filters)"date"===e.type&&(e.defaultValue=g()(e.defaultValue).format(_["DEFAULT_SERVER_DATE_FORMAT"]));return t}var k=a("4328"),C=a.n(k),O={data(){return{afterMetaLoaded(t){},afterDataLoaded(t){},onFiltersUpdating(t,e){return t},transformTableData(t){return t.data.results}}}},x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("platon-link",{staticClass:"mr-2",attrs:{link:"/forms/tables/"+t.table.id+"?table_level="+t.tableLevel+"&_target=modal"}},[a("btn",{attrs:{icon:"fa fa-cog",variant:"primary"}},[t._v(" "+t._s(t.$l("platon.table_setup","Созлаш"))+" ")])],1),a("platon-link",{staticClass:"mr-2",attrs:{link:"/forms/table_columns?table_name="+t.tableName+"&table_level="+t.tableLevel+"&_target=modal"}},[a("btn",{attrs:{icon:"fa fa-plus-circle",variant:"success"}},[t._v(" "+t._s(t.$l("platon.table_add_column","Устун қўшиш"))+" ")])],1),a("platon-link",{staticClass:"mr-2",attrs:{link:"/tables/table_columns?table_name="+t.tableName+"&table_level="+t.tableLevel+"&_target=blank"}},[a("btn",{attrs:{icon:"fa fa-columns",variant:"primary"}},[t._v(" "+t._s(t.$l("platon.table_column_list","Устунлар"))+" ")])],1),a("platon-link",{staticClass:"mr-2",attrs:{link:"/forms/table_filters?table_name="+t.tableName+"&table_level="+t.tableLevel+"&_target=modal"}},[a("btn",{attrs:{icon:"fa fa-plus-circle",variant:"success"}},[t._v(" "+t._s(t.$l("platon.table_add_filter","Фильтр қўшиш"))+" ")])],1),a("platon-link",{staticClass:"mr-2",attrs:{link:"/tables/table_filters?table_name="+t.tableName+"&table_level="+t.tableLevel+"&_target=blank"}},[a("btn",{attrs:{icon:"fa fa-filter",variant:"primary"}},[t._v(" "+t._s(t.$l("platon.table_filter_list","Фильтрлар"))+" ")])],1),a("platon-link",{staticClass:"mr-2",attrs:{link:"/forms/table_buttons?table_name="+t.tableName+"&table_level="+t.tableLevel+"&_target=modal"}},[a("btn",{attrs:{icon:"fa fa-plus-circle",variant:"success"}},[t._v(" "+t._s(t.$l("platon.table_add_button","Тугма қўшиш"))+" ")])],1),a("platon-link",{staticClass:"mr-2",attrs:{link:"/tables/table_buttons?table_name="+t.tableName+"&_target=blank"}},[a("btn",{attrs:{icon:"fa fa-bars",variant:"primary"}},[t._v(" "+t._s(t.$l("platon.table_button_list","Тугмалар"))+" ")])],1)],1)},w=[],D={name:"TableControls",components:{Btn:d["a"]},inject:["tableName","tableLevel"],props:{table:{}}},T=D,$=a("2877"),F=Object($["a"])(T,x,w,!1,null,null,null),S=F.exports,j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.active&&t.showFilters?a("portal",{staticClass:"px-2",staticStyle:{"flex-grow":"100"},attrs:{to:"topbar-filters"}},[a("TableFilterBar",{key:"topbar-filters",staticClass:"form-row table-filters px-2",attrs:{"hide-settings":!0,position:"topbar","item-groups":t.groupedFilters,table:t.table}})],1):t._e(),t.showFilters?a("TableFilterBar",{key:"top-filters",staticClass:"form-row mx-0 py-1 table-filters",attrs:{position:"top","item-groups":t.groupedFilters,table:t.table}}):t._e(),a("div",[t._t("title")],2),t.showFilters?a("TableFilterBar",{key:"top-after-filters",staticClass:"form-row mx-0 py-1 table-filters",attrs:{position:"after-top","item-groups":t.groupedFilters,table:t.table}}):t._e(),t._t("default"),t.showFilters?a("TableFilterBar",{key:"bottom-filters",staticClass:"form-row mx-0 py-1 table-filters",attrs:{position:"bottom","item-groups":t.groupedFilters,table:t.table}}):t._e()],2)},E=[],P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.hasItems?a("div",[t._l(t.elements.left,(function(e,l){return t.shouldDisplay(e)?a(e.__type,{key:t.position+"-left-"+e.__type+"-"+e.id,tag:"component",attrs:{item:e,table:t.table}}):t._e()})),a("div",{staticClass:"mx-auto"}),t._l(t.elements.right,(function(e,l){return t.shouldDisplay(e)?a(e.__type,{key:t.position+"-right-"+e.__type+"-"+e.id,tag:"component",attrs:{item:e,table:t.table}}):t._e()}))],2):t._e()},B=[],L=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d-flex align-items-center over-hover position-relative align-self-end col-auto"},[a("div",{staticClass:"d-flex flex-column"},[t.isAdmin&&t.isMyProject(t.item)?a("PlatonLink",{staticClass:"small over-target align-self-end",attrs:{link:"/forms/table_buttons/"+t.item.id+"?_target=modal&table_name="+t.item.tableName+"&table_level="+t.item.tableLevel}},[a("i",{staticClass:"fa fa-cog"})]):t._e(),a("div",["refresh_table"===t.bType?a("Btn",{class:""+t.cssClass,style:t.cssStyle,attrs:{icon:t.iconClass},nativeOn:{click:function(e){return t.table.reload()}}},[t._v(" "+t._s(t.bTitle)+" ")]):"columns_filter"===t.bType?a("Btn",{staticClass:"d-flex align-items-center",class:""+t.cssClass,style:t.cssStyle,attrs:{icon:t.iconClass},nativeOn:{click:function(e){return t.table.tableColumnFilter()}}},[a("i",{staticClass:"mdi mdi-table-cog mr-1",staticStyle:{"margin-top":"1.2px"}}),t._v(" "+t._s(t.$l("platon.columns.settings"," Устунларни созлаш"))+" ")]):t.isAction?a("ActionBtn",{style:t.cssStyle,attrs:{classes:""+t.cssClass,icon:t.iconClass,js:t.item.js,"js-context":t.table}},[t._v(" "+t._s(t.bTitle)+" ")]):a("PlatonLink",{attrs:{link:t.bLink}},[a("Btn",{class:""+t.cssClass,style:t.cssStyle,attrs:{icon:t.iconClass}},[t._v(t._s(t.bTitle))])],1)],1)],1)])},A=[],M=a("7a0b"),V=a("0490"),N=a("2ce5"),I={name:"TableButton",mixins:[f["a"],N["a"]],components:{ActionBtn:M["a"],PlatonLink:p["a"],Btn:d["a"]},props:{item:{},table:{type:Object,required:!0}},computed:{cssClass(){return this.item.cssClass},cssStyle(){return this.item.cssStyle},iconClass(){return this.item.iconClass},bLink(){return"export_resource"===this.item.type?Object(V["a"])(Object(_["EXPORT_RESOURCE_URL"])(this.item.exportResourceName),this.table.localRoute):this.item.link},bTitle(){return this.item.title||"button"},bWidth(){return this.item.width||2},bType(){return this.item.type},isAction(){return"action"===this.bType}}},R=I,Y=Object($["a"])(R,L,A,!1,null,null,null),U=Y.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(t.item.type+"-control",t._b({key:"e-"+t.item.id,ref:"element",tag:"component",class:t.item.cssClass,style:t.item.cssStyle,attrs:{"element-type":"table_filters","element-id":t.item.id,value:t.local,item:t.item},on:{input:t.onFilterUpdate}},"component",t.extraOptions,!1))},W=[],q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("BaseControl",t._b({ref:"base",attrs:{configurable:!t.hideSettings,errors:t.combinedErrors}},"BaseControl",t.attrs,!1),[a("b-input-group",[a("input",{staticClass:"form-control",class:t.classes,attrs:{type:t.type,autocomplete:t.$attrs.autocomplete||"none",id:t.id,placeholder:t.attrs.label||t.placeholder},domProps:{value:t.maskedValue},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnterPressed.apply(null,arguments)},"update:value":function(e){t.maskedValue=e},input:function(e){return t.onInput(e.target.value)}}}),a("b-input-group-append",[t.allowClear&&t.maskedValue?a("b-button",{attrs:{variant:"text"},on:{click:t.handleClear}},[a("i",{staticClass:"fa fa-times"})]):t._e(),a("b-button",{attrs:{variant:"primary"},on:{click:t.onAction}},[a("i",{class:t.buttonIcon}),t._v(" "+t._s(t.buttonText)+" ")])],1)],1)],1)},H=[],J=a("98d1"),K=a("e117"),G=a("0d16"),X=a("be1f"),Q=a("5111"),Z={name:"TextFilter",components:{Btn:d["a"],BaseControl:J["a"],VueSimpleSuggest:Q["a"]},mixins:[K["a"],X["a"]],props:{},inject:{hideSettings:{default:!1}},data(){return{maskedValue:null,mask:null,maskFilled:!1,data:this.item&&this.item.data,buttonIcon:"fa fa-search",buttonText:"",buttonOnClick:null,onEnter:null,autoCompleteStyle:{vueSimpleSuggest:"position-relative flex-grow-1",inputWrapper:"",defaultInput:"form-control",suggestions:"position-absolute list-group",suggestItem:"list-group-item"}}},beforeMount(){this.attrs.mask&&(this.mask=G["a"].createMask({mask:this.attrs.mask}))},mounted(){this.maskedValue=this.local,this.mask&&this.$watch("local",(t,e)=>{t&&this.mask&&this.updateMaskValue(t)},{immediate:!0}),this.$refs.base.$el.querySelector("input").setAttribute("autocomplete",this.$attrs.autocomplete||"list")},methods:{handleClear(){this.updateLocal(null),this.maskedValue=null},onInput(t){this.markAsDirty(),this.mask?this.updateMaskValue(t):this.maskedValue=t},onAction(){"function"!==typeof this.buttonOnClick?this.updateLocal(this.maskedValue):this.buttonOnClick(this.maskedValue)},updateMaskValue(t){this.maskFilled=!this.mask.isComplete,this.mask.resolve(t.toString()),this.maskedValue=this.mask.value,this.$nextTick(()=>{this.$forceUpdate()})},onValueUpdate(t,e){this.mask&&t&&this.mask&&this.updateMaskValue(t)},onEnterPressed(t){let e=!1;try{this.onEnter&&"function"===typeof this.onEnter&&(e=this.onEnter(this.maskedValue,t))}catch(a){console.warn(a)}!0!==e&&this.updateLocal(this.maskedValue)}},computed:{classes(){return["text-"+(this.attrs.text_align||"left")]},allowClear(){return"boolean"!==typeof this.item.allowClear||this.item.allowClear},type(){return this.attrs.type||"text"}}},tt=Z,et=Object($["a"])(tt,q,H,!1,null,null,null),at=et.exports,lt=a("1cd1"),rt=a("a534"),st=a("85bc"),it=a("f75f"),nt=a("3ac9"),ot=a("b560"),ct=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("BaseControl",t._b({staticClass:"mt-1"},"BaseControl",t.$attrs,!1),[a("date-picker",{attrs:{value:t.range,lang:t.lang,range:"",type:"date",format:"DD.MM.YYYY"},on:{input:t.updateRange}})],1)},ut=[],dt=a("ec45");a("411c");const pt={formatLocale:{months:["январ","февраль","март","апрел","май","июн","июл","август","сентябр","октябр","ноябр","декабр"],monthsShort:["янв","февр","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],weekdays:["Якшанба","Душанба","Сешанба","Чоршанба","Пайшанба","Жума","Шанба"],weekdaysShort:["Якш","Душ","Сеш","Чор","Пай","Жум","Шан"],weekdaysMin:["Як","Ду","Се","Чо","Па","Жу","Ша"],firstDayOfWeek:1,firstWeekContainsDate:1},yearFormat:"YYYY",monthFormat:"MMM",monthBeforeYear:!0},ht={formatLocale:{months:["Yanvar","Fevral","Mart","Aprel","May","Iyun","Iyul","Avgust","Sentyabr","Oktyabr","Noyabr","Dekabr"],monthsShort:["Yanv","Fev","Mar","Apr","May","Iyun","Iyul","Avg","Sen","Okt","Noy","Dek"],weekdays:["Yakshanba","Dushanba","Seshanba","Chorshanba","Payshanba","Juma","Shanba"],weekdaysShort:["Yak","Dush","Sesh","Chor","Pay","Jum","Shan"],weekdaysMin:["Yak","Du","Se","Cho","Pa","Ju","Sha"],firstDayOfWeek:1,firstWeekContainsDate:1},yearFormat:"YYYY",monthFormat:"MMM",monthBeforeYear:!0};dt["default"].locale("uz",pt),dt["default"].locale("la",ht);a("107a");var mt=a("d88a"),bt={name:"TableFilterDateRangePicker",components:{DatePicker:dt["default"],BaseControl:J["a"]},props:{value:{},item:{}},data(){return{range:this.parseDateFromValue(this.value),lang:mt["e"].locale}},methods:{parseDateFromValue(t){return Array.isArray(t)?t.map(t=>{let e=g()(t,_["DEFAULT_SERVER_DATE_FORMAT"]);return e.isValid()?e.toDate():null}):null},formatDate(t){return t.filter(t=>t).map(t=>g()(t).format(_["DEFAULT_SERVER_DATE_FORMAT"]))},updateRange(t){this.range=t,this.$emit("input",this.formatDate(t))}},watch:{value:{handler(t){this.range=this.parseDateFromValue(t)}}}},ft=bt,yt=Object($["a"])(ft,ct,ut,!1,null,null,null),gt=yt.exports,_t=a("64f5"),vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("BaseControl",t._b({attrs:{errors:t.combinedErrors}},"BaseControl",t.$attrs,!1),[a("tree-select",{attrs:{normalizer:t.normalizer,valueFormat:"object",loadOptions:t.loadOptions,options:t.options,clearable:t.allowClear,placeholder:t.item.placeholder||"",noOptionsText:t.$l("platon.select_has_no_data","Натижа топилмади"),noResultsText:t.$l("platon.select_has_no_data","Натижа топилмади")},model:{value:t.local,callback:function(e){t.local=e},expression:"local"}})],1)},kt=[],Ct=a("813d");function Ot(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,l)}return a}function xt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Ot(Object(a),!0).forEach((function(e){i()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ot(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var wt={name:"TreeSelectFilter",components:{BaseControl:J["a"]},mixins:[Ct["a"]],props:{item:{},value:{}},data(){return{options:[]}},inject:["table"],computed:{local:{get(){if(!this.value||"string"!==typeof this.value)return null;const t=this.value.split(","),e=(t,a,l)=>{if(t&&t.children&&a.length>l){const r=t.children.find(t=>t.id==a[l]);return r?e(r,a,l+1):null}return t};return e({children:this.options},t,0)},set(t){t||this.$emit("input",t);const e=t.paths.join(",");this.$emit("input",e)}},allowClear(){return"boolean"===typeof this.item.allowClear&&this.item.allowClear}},mounted(){var t=this;return u()((function*(){const e=t.parseData(t.item.data);yield t.getSelectedOptionChildren(e),t.options=e}))()},methods:{getSelectedOptionChildren(t){var e=this;return u()((function*(){if(e.value&&"string"===typeof e.value){const a=e.value.split(",");a.length>1&&(yield e.getChildrenOptions(t,a,0))}}))()},getChildrenOptions(t,e,a){var l=this;return u()((function*(){if(e.length<a+1||!t.length)return;const r=l.findNodeAmongChildrenById(t,e[a]);if(r){r.children=yield l.getChildren(r);const t=l.findNodeAmongChildrenById(r.children,e[a+1]);t&&(yield l.getChildrenOptions(t.children,e,a+1))}}))()},findNodeAmongChildrenById(t,e){return t||Array.isArray(t)?t.find(t=>t.id==e):null},normalizer(t){return xt(xt({},t),{},{id:t.paths.join(","),name:this.translateOption(t)})},parseData(t){return t.map(t=>(this.setDeepValues(t),xt({},t)))},setDeepValues(t,e){return t.paths=[],e&&(t.paths=o()(e.paths)),t.label=t.name,t.paths.push(t.id),t.children?t.children.forEach(e=>this.setDeepValues(e,t)):t.children=!!t.has_children&&null,t},loadChild(t,e){var a=this;return u()((function*(){const{tableName:l}=a.table,{key:r}=a.item,{data:s}=yield a.$http.post(`tables/${l}/${r}/select-list`,{parentId:t.id,selectLevel:e});return s}))()},getChildren(t){var e=this;return u()((function*(){t.isDefaultExpanded=!0;let a=yield e.loadChild(t,t.paths.length);return a.forEach(a=>{e.setDeepValues(a,t)}),a}))()},loadOptions(t){var e=this;let{action:a,callback:l,parentNode:r}=t;return u()((function*(){"LOAD_CHILDREN_OPTIONS"===a&&(r.children=yield e.getChildren(r),l())}))()},translateOption(t){return t["name_"+mt["e"].locale]||t.name}}},Dt=wt,Tt=Object($["a"])(Dt,vt,kt,!1,null,null,null),$t=Tt.exports;function Ft(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,l)}return a}function St(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Ft(Object(a),!0).forEach((function(e){i()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ft(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var jt={name:"PlatonFilterElement",components:{DateControl:st["a"],DatetimeControl:it["a"],CheckboxControl:rt["a"],SelectControl:lt["a"],TextControl:at,NumberControl:ot["a"],TimeControl:nt["a"],DaterangeControl:gt,treeselectControl:$t},props:{item:{},table:{type:Object,required:!0}},data(){let t=Object(_t["p"])(this.table.filterData[this.item.key],Object(_t["p"])(this.item.defaultValue,null));return{local:t,startTime:new Date}},created(){this.item.key&&(this.table.filterElements.set(this.item.key,this),_["DEV_MODE"]&&console.log(`Mounting ${this.item.key} to ${this.table.tableName}`))},mounted(){this.table&&this.$watch("table.filterData."+this.item.key,(t,e)=>{this.local=t})},beforeDestroy(){this.item.key&&this.table.filterElements.delete(this.item.key)},methods:{onFilterUpdate(t){(new Date).getTime()-this.startTime.getTime()>=1e3&&this.table.resetPage(),this.table.setFilter(this.item.key,t)}},computed:{extraOptions(){let t=this.item.attributes||{};return t=St({class:"align-self-end"},t),"select"===this.item.type?(t.placeholder=this.item.title,t.label=this.item.title):(this.item.type,t.label=this.item.title),"date"!==this.item.type&&"datetime"!==this.item.type||(t["hasControls"]=!0,t["text_align"]="center"),t.size=this.item.width||2,t.defaultValue=this.item.defaultValue,t.disableLabel=!t.has_label,t}}},Et=jt,Pt=Object($["a"])(Et,z,W,!1,null,null,null),Bt=Pt.exports,Lt=a("1832"),At={name:"TableFilterBar",components:{TableButton:U,TableFilter:Bt},props:{position:{required:!0,type:String},itemGroups:{type:Object,required:!0},table:{type:Object,required:!0},hideSettings:{type:Boolean,default:!1}},provide(){return{table:this.table,hideSettings:this.hideSettings}},methods:{collectAndSort(t){const e=[];return Array.isArray(this.itemGroups[`${this.position}-${t}`])&&e.push.apply(e,o()(this.itemGroups[`${this.position}-${t}`])),e.sort((t,e)=>t.sortOrder-e.sortOrder),e},shouldDisplay(t){return!t.displayCondition||("function"===typeof t.displayCondition?t.displayCondition.call(this,this.table):"string"===typeof t.displayCondition?Object(Lt["a"])(t.displayCondition,this,{table:this.table}):void 0)}},computed:{elements(){return{left:this.collectAndSort("left"),right:this.collectAndSort("right")}},hasItems(){return this.elements.left.length+this.elements.right.length>0}}},Mt=At,Vt=Object($["a"])(Mt,P,B,!1,null,null,null),Nt=Vt.exports,It=a("e831"),Rt=a.n(It),Yt={name:"TableFilterWrapper",components:{TableFilterBar:Nt},props:{showFilters:{type:Boolean,default:!0},items:{type:Array,required:!0},value:{type:Object}},inject:["table"],computed:{groupedFilters(){return Rt()(this.items,"position")}},mounted(){_["DEV_MODE"]&&console.log("Mounting "+this.table.tableName)},data(){return{active:!0}},activated(){this.active=!0},deactivated(){this.active=!1},methods:{setFilter(){}}},Ut=Yt,zt=Object($["a"])(Ut,j,E,!1,null,null,null),Wt=zt.exports,qt=a("6781"),Ht=a("6f3b"),Jt=a("a986"),Kt=a("dd84"),Gt=a("6304"),Xt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.breadcrumbs&&t.breadcrumbs.items&&t.breadcrumbs.items.length>0?a("b-breadcrumb",{staticClass:"mb-0 py-1"},t._l(t.breadcrumbs.items,(function(e,l){return a("li",{key:l,staticClass:"breadcrumb-item"},[l+1===t.breadcrumbs.items.length?a("span",[t._v(t._s(t.$l(e.translate,e.text)))]):a("platon-link",{attrs:{link:e.link}},[t._v(t._s(t.$l(e.translate,e.text)))]),a("table-breadcrumb-dropdown",{attrs:{breadcrumbs:t.breadcrumbs,index:l}})],1)})),0):t._e()},Qt=[],Zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.breadcrumbs.items.length+1>=t.index&&t.allOptions.length>0?a("div",{staticClass:"d-inline-block pl-2 dropdown",on:{click:function(e){return e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.show()}}},[a("i",{staticClass:"fa",class:t.shown?"fa-caret-down":"fa-caret-right"}),a("div",{staticClass:"dropdown-menu",class:{show:t.shown}},[t.allOptions.length>=10?a("div",{staticClass:"mx-2 my-1"},[a("b-form-input",{ref:"search",staticClass:"mb-2",attrs:{size:"sm",placeholder:t.$l("platon.search_dots","Излаш...")},on:{click:function(t){t.preventDefault(),t.stopPropagation()}},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1):t._e(),t.allOptions.length>0&&0===t.options.length?a("div",[a("div",{staticClass:"mx-3 mt-2 mb-1 text-nowrap"},[t._v(" "+t._s(t.$l("platon.select_has_no_data","Натижа топилмади"))+" ")])]):t._e(),a("div",{staticStyle:{"max-height":"400px","overflow-y":"auto"}},t._l(t.options,(function(e,l){return a("platon-link",{key:l,staticClass:"dropdown-item",attrs:{link:e.link}},[t._v(" "+t._s(t.$l(e.translate,e.text))+" ")])})),1)])]):t._e()},te=[],ee={name:"TableBreadcrumbDropdown",props:{breadcrumbs:{},index:{type:Number,required:!0}},data(){return{shown:!1,filterText:null}},methods:{show(){this.shown||(this.shown=!0,setTimeout(()=>{window.addEventListener("click",()=>{this.shown=!1},{once:!0})}))}},computed:{level(){return this.index+1},allOptions(){try{return this.breadcrumbs.options.filter(t=>t.level===this.level)}catch{return[]}},options(){try{return this.allOptions.filter(t=>!this.filterText||!t.text||t.text.toLowerCase().includes(this.filterText))}catch{return[]}}},watch:{shown(t){t&&this.$refs.search&&this.$nextTick(()=>{this.$refs.search.focus()})}}},ae=ee,le=Object($["a"])(ae,Zt,te,!1,null,null,null),re=le.exports,se={name:"TableBreadcrumb",components:{TableBreadcrumbDropdown:re},props:{endpoint:{},filters:{}},data(){return{breadcrumbs:[]}},created(){$api.get(this.endpoint,{params:this.filters}).then(t=>{let{data:e}=t;this.breadcrumbs=e.data})}},ie=se,ne=Object($["a"])(ie,Xt,Qt,!1,null,null,null),oe=ne.exports,ce=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("dynamic-page-renderer",{directives:[{name:"show",rawName:"v-show",value:t.isLoaded,expression:"isLoaded"}],attrs:{page:t.pageProperties},on:{pageLoaded:t.onPageLoaded}})},ue=[],de=a("b660"),pe={name:"ComponentMaker",components:{DynamicPageRenderer:de["a"]},props:{name:{required:!0,default:""},content:{required:!0,default:"<span></span>"}},data(){return{isLoaded:!1}},methods:{onPageLoaded(){this.isLoaded=!0}},computed:{pageProperties(){return{component:null,components:this.$projectInfo.components||[],content:this.content,css:null,data:{},id:1,isPublic:!1,js:null,name:"component-maker-"+this.name,projectId:0,title:"",vueCode:null}}}},he=pe,me=Object($["a"])(he,ce,ue,!1,null,null,null),be=me.exports;function fe(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,l)}return a}function ye(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?fe(Object(a),!0).forEach((function(e){i()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):fe(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function ge(t){for(let e of Object.keys(t))null!==t[e]&&void 0!==t[e]&&""!==t[e]||delete t[e],"_page"===e&&"1"==t[e]&&delete t[e];return t}const _e="platon_api";var ve={name:"platon-table",components:{TableBreadcrumb:oe,ChimeraErrorsView:qt["a"],TableFilterWrapper:Wt,TableControls:S,PlatonLink:p["a"],Btn:d["a"],PTable:h["a"],NotificationContainer:Gt["a"],ComponentMaker:be},mixins:[b["a"],f["a"],m["b"],Jt["a"],O,Ht["a"],N["a"]],props:{tableName:{type:String},autoHeight:{type:Boolean,default:!0},extraColumns:{type:Array,default:()=>[]},controlButtons:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!1},paginationEnabled:{type:Boolean,default:!0},showFilters:{type:Boolean,default:!0},tableClasses:{type:String,default:""},tableFilters:{default:()=>({})},extraFilters:{default:()=>({})},extraData:{default:()=>{}},externalFilters:{default:()=>[],type:Array},useExternalButtons:{type:Boolean,default:!1},useExternalFilters:{type:Boolean,default:!1},navigateByKeyboard:{default:!1,type:Boolean},draw:{default:!0,type:Boolean},maxHeight:{type:String,default:void 0}},provide(){return{table:this,platonTable:this,tableName:this.tableName,tableLevel:this.tableLevel}},data(){let t=Number(this.tableFilters&&this.tableFilters["_page"])||1;return{currentPage:t,filterData:{},manualFiltersUpdate:!1,_lockFilters:!0,filterElements:new Map,breadcrumbsEndpoint:null,splitRowsBy:void 0}},chimera:{loadTable(){var t=this;let e=C.a.stringify(this.activeFilters,{arrayFormat:"brackets"}),a=this.addPublicRoutePrefix(`tables/${this.tableName}/meta?`+e);return{url:a,auto:!1,transformer:v,on:{success:function(){var e=u()((function*(e){t.$clearEvents(),e.data&&e.data.js&&t.injectScopeJs(e.data.js,t),yield t.$nextTick(),t.afterMetaLoaded(e.data),yield t.$chimera.loadTableData.reload(),t._lockFilters=!1,t.$emit("onMetaLoaded",e.data),t.$plugins.triggerEvent(Kt["a"].OnTableOpened,t.$route)}));return function(t){return e.apply(this,arguments)}}()}}},loadTableData(){var t=this;let e,a;if(this.table&&this.table.dataSourceType&&this.table.dataSourceType.toLowerCase()===_e)e=this.table.dataUrl,a=this.$api;else{a=this.$http;let t=C.a.stringify(this.activeFilters,{arrayFormat:"brackets"});e=this.addPublicRoutePrefix(`tables/${this.tableName}/data?`+t)}return{url:e,axios:a,interval:1e3*(this.table&&this.table.refreshTimeout||3600),auto:!1,keepData:!1,on:{success:function(){var e=u()((function(e){let{data:a}=e;return function*(){t.$nextTick(()=>{t.$emit("tableLoaded",t)}),yield t.$nextTick(),t.afterDataLoaded(a)}()}));return function(t){return e.apply(this,arguments)}}()}}}},computed:{pageSize(){let t=10;try{t=this.$chimera.loadTable.data.paginationSize}catch(e){}return t},tableLevel(){try{return this.table.level}catch{return 1}},table(){try{return this.$chimera.loadTable.data}catch(t){return{}}},filtersAndButtons(){try{return[].concat(o()((this.$chimera.loadTable.data.filters||[]).map(t=>ye(ye({},t),{},{__type:"table-filter"}))),o()((this.$chimera.loadTable.data.buttons||[]).map(t=>ye(ye({},t),{},{__type:"table-button"}))))}catch{return[]}},renderingFilters(){let t=[];return this.useExternalFilters?t.push.apply(t,o()(this.externalFilters.filter(t=>"table-filter"===t.__type))):t.push.apply(t,o()(this.filtersAndButtons.filter(t=>"table-filter"===t.__type))),this.useExternalButtons?t.push.apply(t,o()(this.externalFilters.filter(t=>"table-button"===t.__type))):t.push.apply(t,o()(this.filtersAndButtons.filter(t=>"table-button"===t.__type))),t},columns(){try{return this.table.columns}catch(t){return[]}},groupingBy(){return this.table.groupingField},columnsConfig(){var t;return(null===(t=this.table.userColumns)||void 0===t?void 0:t.column_config)||{}},tableId(){var t;return null===(t=this.table)||void 0===t?void 0:t.id},notificationEvent(){return this.table.attributes.notification_event},data(){try{return this.$chimera.loadTableData.data.data}catch(t){return{}}},tableData(){try{var t;return this.transformTableData(null===(t=this.$chimera.loadTableData)||void 0===t?void 0:t.data)||[]}catch(e){return[]}},showPagination(){return 200===this.$chimera.loadTable.status&&200===this.$chimera.loadTableData.status&&this.columns.length>0&&this.data.total>this.pageSize&&this.pageSize>0},activeFilters(){let t=ye({},this.extraFilters);return Object.keys(this.filterData||{}).forEach(e=>{void 0!==this.filterData[e]&&("string"===typeof this.filterData[e]&&0===this.filterData[e].length||null!==this.filterData[e]&&!1!==this.filterData[e]&&(t[e]=this.filterData[e]))}),t},showTableSkeleton(){return this.$chimera.loadTable.loading||this.$chimera.loadTableData.loading},paginationStats(){const t={total:this.data.total,from:(this.currentPage-1)*this.pageSize+1,to:(this.currentPage-1)*this.pageSize+this.data.results.length};return t},params(){try{return this.$chimera.loadTable.data.params}catch{return{}}}},methods:{onFormSaved(){this.$chimera.loadTable.fetch(!0)},reload(){this.$chimera.loadTable.fetch(!0)},resetPage(){this.currentPage=1},setFilter(t,e){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.$set(this.filterData,t,e),this.manualFiltersUpdate&&!a||this.emitFilters()},emitFilters(){this.$emit("onFiltersChange",ge(ye({},this.filterData)))},findColumnByIdOrDataField(t){function e(a){for(let l of a){if(l.dataField===t||l.id===t)return l;if(Array.isArray(l.children)&&l.children.length>0){let t=e(l.children);if(t)return t}}return null}return e(this.columns)},setColumnAttr(t,e,a){try{const l=this.findColumnByIdOrDataField(t);this.$set(l,e,a)}catch(l){_["DEV_MODE"]&&console.error(l)}},exportXlsx(){this.$refs.table&&this.$refs.table.exportXlsx()},tableColumnFilter(){this.$refs.table.showColumnFilter()}},mounted(){this.$chimera.loadTable.fetch(),window.addEventListener(m["a"].FORM_SAVED,this.onFormSaved)},beforeDestroy(){window.removeEventListener(m["a"].FORM_SAVED,this.onFormSaved)},watch:{currentPage:{handler(t,e){t!==e&&this.setFilter("_page",t>1?t:1,!0)}},tableFilters:{immediate:!0,handler(t,e){if(Object(_t["o"])(t,this.filterData)){let a=this.onFiltersUpdating(ge(ye(ye({},this.filters),t)),e);this.$set(this,"filterData",a),this.manualFiltersUpdate||this.emitFilters()}}},activeFilters(t){let e=null;Number.isInteger(Number(t["_page"]))&&Number(t["_page"])!==this.currentPage?e=Number(t["_page"]):t["_page"]||(e=1),this.manualFiltersUpdate?e&&(this.currentPage=e):this._lockFilters||(e&&(this.currentPage=e),this.$chimera.loadTable.fetch())}}},ke=ve,Ce=Object($["a"])(ke,l,r,!1,null,null,null);e["default"]=Ce.exports}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0bb231"],{"39d9":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("BaseControl",e._b({attrs:{errors:e.combinedErrors}},"BaseControl",e.$attrs,!1),[n("l-map",{ref:"map",staticStyle:{height:"300px"},attrs:{zoom:e.zoom,center:e.center},on:{click:e.onMapClick,ready:e.onReady,baselayerchange:e.layerChanged}},[n("l-control-layers",{attrs:{position:"topright",collapsed:!1,"sort-layers":!1}}),e._l(e.tileProviders,(function(e){return n("l-tile-layer",{key:e.name,attrs:{name:e.name,subdomains:e.subdomains,visible:e.visible,url:e.url,attribution:e.attribution,"layer-type":"base"}})})),e._l(e.item.mapElements,(function(t,a){return e.item.mapElements?n(t,{key:a,tag:"component"}):e._e()})),e.selectedPoint?n("l-marker",e._b({attrs:{"lat-lng":e.selectedPoint}},"l-marker",e.markerOptions(),!1),[n("l-popup",{staticClass:"text-center",staticStyle:{width:"130px"}},[n("div",{staticClass:"p-2 text-nowrap"},[e._v(" "+e._s(e.local)+" ")]),e.isDisabledOrReadOnly?e._e():n("b-btn",{staticClass:"btn btn-danger",attrs:{size:"sm"},on:{click:function(t){e.selectedPoint=null}}},[e._v(" "+e._s(e.$l("platon.map_remove_marker","Ўчириш"))+" ")])],1)],1):e._e()],2)],1)},l=[],i=n("c973"),o=n.n(i),s=n("448a"),r=n.n(s),c=n("e11e"),p=n("98d1"),m=n("be1f"),u=n("1d9c"),d=(n("95e5"),n("813d"));function h(e){if("string"===typeof e){const[t,n]=e.split(",");return Object(c["latLng"])(parseFloat(t),parseFloat(n))}return null}var g={name:"MapControl",components:{BaseControl:p["a"]},mixins:[m["a"],d["a"]],props:{value:{}},data(){let e=this.item.mapCenter?c["latLng"].apply(void 0,r()(this.item.mapCenter.split(","))):Object(c["latLng"])(41.311081,69.240562),t=this.item.mapZoom?Number(this.item.mapZoom):12,n=u["a"].map(e=>(e.visible=e.name===this.item.activeMap,e));return{selectedPoint:null,center:e,zoom:t,tileProviders:n,local:null,map:null}},mounted(){this.fixInTab(),this.value&&this.value.includes(",")&&(this.selectedPoint=c["latLng"].apply(void 0,r()(this.value.split(","))),this.center=this.selectedPoint),this.initMapControls()},methods:{getMap(){return this.$refs.map.mapObject},getFullScreenDependency(){var e=this;return o()((function*(){yield Promise.all([e.addStyle("https://unpkg.com/platon-leaflet-fullscreen@0.0.1/dist/style.css"),e.addScript("https://unpkg.com/platon-leaflet-fullscreen@0.0.1/dist/fullscreen.js")])}))()},getGeoCoderDependency(){var e=this;return o()((function*(){yield Promise.all([e.addStyle("https://unpkg.com/leaflet-geonames@0.4.9/L.Control.Geonames.css"),e.addScript("https://unpkg.com/leaflet-geonames@0.4.9/L.Control.Geonames.min.js")])}))()},initSearchControl(){var e=this;return o()((function*(){yield e.getGeoCoderDependency(),yield e.wait(500);const t=e.getMap(),n=L.control.geonames({position:"topleft",country:"UZ",geonamesSearch:"https://secure.geonames.org/searchJSON",geonamesPostalCodesSearch:"https://secure.geonames.org/postalCodeSearchJSON",username:"shohrux_saidov",maxresults:15,zoomLevel:null,className:"leaflet-geonames-icon",workingClass:"leaflet-geonames-icon-working",featureClasses:["A","H","L","P","R","S","V"],baseQuery:"isNameRequired=true",showMarker:!1,showPopup:!0,adminCodes:{country:"UZ"},bbox:{},lang:"uz",alwaysOpen:!1,title:"Search by location name or postcode",placeholder:"Enter a location name"});t.addControl(n)}))()},initFullControl(){var e=this;return o()((function*(){yield e.getFullScreenDependency(),yield e.wait(500),e.getMap().addControl(new L.Control.Fullscreen({title:{false:e.$l("fullScreen","Toliq qilib ochish"),true:e.$l("exitFromFullScreen","To'liq ekrandan chiqish")}}))}))()},wait(e){return o()((function*(){return new Promise(t=>{setTimeout(t,e)})}))()},initMapControls(){this.initFullControl(),this.initSearchControl()},onMapClick(e){var t=this;return o()((function*(){t.isDisabledOrReadOnly||("function"!==typeof t.item.validateMarker||(yield t.item.validateMarker(e.latlng.wrap(),e)))&&(t.selectedPoint=e.latlng.wrap())}))()},onReady(e){this.map=e,e.flyTo(this.center,this.zoom)},layerChanged(e){this.$nextTick(()=>{const t=this.map,n=t.getCenter();e.name.includes("Yandex")?t.options.crs=L.CRS.EPSG3395:t.options.crs=L.CRS.EPSG3857,t.setView(n),t._resetView(t.getCenter(),t.getZoom(),!0)})},fixInTab(){let e=this.$parent;while(e){if("BTab"===e.$options.name){e.$on("click",()=>{this.$refs.map.mapObject._onResize()});break}e=e.$parent}}},computed:{markerOptions(){return this.item.markerOptions?this.item.markerOptions:()=>{}}},watch:{selectedPoint(e){this.local=e?`${e.lat.toFixed(6)},${e.lng.toFixed(6)}`:null,this.$emit("input",this.local)},value:{handler(e){e!==this.local&&(this.selectedPoint=h(e),this.center=this.selectedPoint)}}}},y=g,f=n("2877"),b=Object(f["a"])(y,a,l,!1,null,null,null);t["default"]=b.exports}}]);